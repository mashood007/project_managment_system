$(document).ready(function(){

jQuery(function() {
  return $(".cancel_purchase_invoice").on("click", function(e) {
    e.preventDefault();
    return       swal({
        title: 'Are you sure?',
        text: "You won't be able to revert!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3f51b5',
        cancelButtonColor: '#ff4081',
        confirmButtonText: 'Great ',
        buttons: {
          cancel: {
            text: "Cancel",
            value: null,
            visible: true,
            className: "btn btn-danger ",
            closeModal: true,
          },
          confirm: {
            text: "Ok, Confirm",
            value: true,
            visible: true,
            className: "btn btn-primary ",
            closeModal: true
          }
        }
      }).then(function(event) {
  setTimeout(function() {
    console.log(event)
  }, 2);
});


  });
});

// ---
// generated by coffee-script 1.9.2


$('.party_type').change(function(){
    if($(this).val() == 'temp')
    {
      $('#old_party').hide()
      $('.temp_party').show()
    }
    else
    {
      $('#old_party').show()
      $('.temp_party').hide()
    }
    //temp_user
  });


$('#cash_paid').keyup(function(){
	balanceWillBe()

});

$('#purchase_invoice_submit').click(function(){
	var party_type = $('.party_type:checked')
	if (party_type.val() == 'old')
	{
		
		var party_id = $('#customers_ddlb').val()
		if (party_id != "")
		{
		party_id = "<input type='hidden' name='party_id' value='"+party_id+"'>"
		var selled_by = $('#customers_ddlb').find(':selected').data('type')
		selled_by = "<input type='hidden' name='selled_by' value='"+selled_by+"'/>"
		var form = append_into_purchase_form(party_type, party_id, selled_by)
		form.submit()
		}
		else
		{
			showWarningToast('Party Name should not be blank')
		}
	}
	else
	{
		create_temp_party(party_type)
	}

});

});


function balanceWillBe()
{
	var total = $('#total_amount').text()
	var balance = total - $('#cash_paid').val()
	var text  = ""
	if (balance > -1 )
	{
	  text = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Balance will be: <font color='green' size='5' class='display-4'> ₹"+balance+"</font> <font color='grey' size='1'>is advanced</font><br>"
	}
	else
	{
	  balance = balance * -1;
	  text = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Balance will be: <font color='red' size='5' class='display-4'> ₹"+balance+"</font> <font color='grey' size='1'>is arrears</font><br>"
	}
	$('#balance_will_be').html(text)
}

function append_into_purchase_form(party_type, party_id, selled_by)
{

	var form = $('#purchase_invoice_form');
	form.append($('#purchase_date'))
	form.append($('.purchase_type:checked'))
	form.append(party_type)
	form.append(party_id)
	form.append($('#about'))
	form.append(selled_by)
	return form		
}


function create_temp_party(party_type)
{
	var name = $('#temp_parties').val()
	var phone = $('#phone').val()
	var gstin = $('#gstin').val()
	if (name != "")
	{
        $.ajax({
           url: $('#temp_party_url').val(),
           type: 'POST',
           data: {name: name, phone: phone, gstin: gstin },
           error: function(data) {
           },

           success: function(data) {
             var party_id = "<input type='hidden' name='party_id' value='"+data+"'>"
             var selled_by = "<input type='hidden' name='selled_by' value='temp_party'/>"
             var form = append_into_purchase_form(party_type, party_id, selled_by)
			form.submit()
           }

        });	
     }
     else
     {
     	showWarningToast('Party Name should not be blank')

     } 
}

function load_items(url){
	var item_category = $('#purchase_item_category').val()
	

        $.ajax({
           url: url,
           type: 'POST',
           data: {item_category: item_category },

           error: function(data) {

              alert('Something is wrong'+data);

           },

           success: function(data) {
           	$('#purchase_items').html(data)
            // alert('success'+data);
           }

        });
}


function get_item()
{
	var item = $('#purchase_items').find(':selected')
	var item_type = item.data('type')
  if (item_type == 'non_sale')
  {
    units(item.val(), 'non_sale')
  }
  else
  {
    var price = item.data('price')
    var discound = item.data('discound')
    var tax_ex_in = item.data('tax_ex_in')
    $('#purchase_amount').val(price)
    $('#tax_ex_in').val(tax_ex_in)
    units(item.val(), 'product')
  }
}

function add_purchase_item(url)
{
	var unit = $('#units_list').val()
	var item = $('#purchase_items').val()
	var tax_ex_in =  $('#tax_ex_in').find(':selected').val()
	var price = $('#purchase_amount').val()
	var purchase_qty = $('#purchase_qty').val()
	var purchase_item_category = $('#purchase_item_category').val()
     

    $.ajax({
       url: url,
       type: 'POST',
       data: {item: item, item_type: purchase_item_category, unit: unit, tax_ex_in: tax_ex_in, price: price, quantity: purchase_qty },
        error: function(data) {
         // alert('Something is wrong'+data);
         showWarningToast('Something is wrong')
         console.log(data)
        },
        success: function(data) {
	       	$('#purchase_cart').html(data)
	       	showSuccessToast('Cart Updated')
            // alert('success'+data);
        }

        });

}


function add_purchase_return_item(url)
{
	var unit = $('#units_list').val()
	var item = $('#purchase_items').val()
	var purchase_qty = $('#purchase_qty').val()
    $.ajax({
       url: url,
       type: 'POST',
       data: {item: item, unit: unit, quantity: purchase_qty },
        error: function(data) {
         // alert('Something is wrong'+data);
         showWarningToast('Something is wrong')
        },
        success: function(data) {
	       	$('#purchase_cart').html(data)
	       	showSuccessToast('Cart Updated')
            // alert('success'+data);
        }

        });

}

function cart(url)
{
    $.ajax({
       url: url,
       type: 'POST',
       data: {},
        error: function(data) {
         // alert('Something is wrong'+data);
         showWarningToast('Something is wrong')
         console.log(data)
        },
        success: function(data) {
	       	$('#purchase_cart').html(data)
            // alert('success'+data);
        }

        });
}

function delete_purchase_item(url)
{
	var invoice_no = $('#edit_invoice_no').val()

	    $.ajax({
       url: url,
       type: 'POST',
       data: {invoice: invoice_no},
           error: function(data) {
             showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_cart').html(data)
            showSuccessToast('Cart Updated')
            //alert(data);
           }

        });
}

function delete_purchase_return_item(url)
{
	
	    $.ajax({
       url: url,
       type: 'POST',
           error: function(data) {
             showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_cart').html(data)
            showSuccessToast('Cart Updated')
           }

        });	
}


function update_purchase_order_cart(url, id)
{
	
	var price = $("#edit_cart_modal_"+id).find("#price").val()
	var quantity = $("#edit_cart_modal_"+id).find("#quantity").val()
	var invoice_no = $('#edit_invoice_no').val()
		    $.ajax({
       url: url,
       type: 'POST',
       data: {price: price, quantity: quantity, invoice: invoice_no},
           error: function(data) {
              //alert('Something is wrong'+data);
              showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_cart').html(data)
            showSuccessToast('Cart Updated')
            //alert(data);
           }

        });
}

function update_cart(url, id)
{
	
	var price = $("#edit_cart_modal_"+id).find("#price").val()
	var quantity = $("#edit_cart_modal_"+id).find("#quantity").val()
	var invoice_no = $('#edit_invoice_no').val()
		    $.ajax({
       url: url+id,
       type: 'POST',
       data: {price: price, quantity: quantity, invoice: invoice_no},
           error: function(data) {
              //alert('Something is wrong'+data);
              showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_cart').html(data)
            showSuccessToast('Cart Updated')
            //alert(data);
           }

        });
}

function update_return_cart(url, id, dc_id)
{
	var quantity = $("#edit_cart_modal_"+id).find("#quantity").val()
  if (dc_id != 0)
  {
    url = url+id+'/'+dc_id
  }
  else
  {
    url = url+id
  }
	$.ajax({
       url: url,
       type: 'POST',
       data: { quantity: quantity},
           error: function(data) {
              //alert('Something is wrong'+data);
              showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_cart').html(data)
            showSuccessToast('Cart Updated')
            //alert(data);
           }
    });
}

function edit_cart(id) {
   $("#edit_cart_modal_"+id).show()
   $("#edit_cart_modal_"+id).css({'opacity' : '1', "background" : "rgba(53, 53, 53, 0.3) none repeat scroll 0% 0%"});
   
}

function submit_purchase_return()
{
	$('#purchase_invoice__return_form').append($('#about')).submit()
}

function cancel(url)
{
  swal({
        title: 'Are you sure?',
        text: "You won't be able to revert!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3f51b5',
        cancelButtonColor: '#ff4081',
        confirmButtonText: 'Great ',
        buttons: {
          cancel: {
            text: "Cancel",
            value: null,
            visible: true,
            className: "btn btn-danger ",
            closeModal: true,
          },
          confirm: {
            text: "Ok, Confirm",
            value: true,
            visible: true,
            className: "btn btn-primary ",
            closeModal: true
          }
        }
      }).then(function(event) {
        setTimeout(function() {
          if(event)
          {
            cancel_invoice(url)
          }
        }, 2);
      });  
}

function cancel_invoice(url)
{
	$.ajax({
       url: url,
       type: 'POST',
           error: function(data) {
              showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_report_content').html(data)
            showSuccessToast('Canceled')
           }
    });	
}


function show_image() {
   $("#show_image").show()
   $("#show_image").css({'opacity' : '1', "background" : "rgba(53, 53, 53, 0.3) none repeat scroll 0% 0%"});

}





function sendMeterialOrder(url)
{
  swal({
        title: 'Are you sure?',
        text: "You won't be able to revert!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3f51b5',
        cancelButtonColor: '#ff4081',
        confirmButtonText: 'Great ',
        buttons: {
          cancel: {
            text: "Cancel",
            value: null,
            visible: true,
            className: "btn btn-danger ",
            closeModal: true,
          },
          confirm: {
            text: "Ok, Confirm",
            value: true,
            visible: true,
            className: "btn btn-primary ",
            closeModal: true
          }
        }
      }).then(function(event) {
        setTimeout(function() {
          if(event)
          {
            send_order(url)
          }
        }, 2);
      });  
}

function send_order(url)
{
  $.ajax({
       url: url,
       type: 'POST',
           error: function(data) {
              showWarningToast('Something is wrong')
           },
           success: function(data) {
            $('#purchase_report_content').html(data)
            showSuccessToast('The Order was send')
           }
    }); 
}
